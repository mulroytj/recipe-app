<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Recipes">
  <meta name="theme-color" content="#EA580C">
  <title>Recipe Database</title>
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    [data-lucide] {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 2;
      fill: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    const SUPABASE_URL = 'https://tclszwdvmpgtquzrtqvw.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRjbHN6d2R2bXBndHF1enJ0cXZ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyMjg2MjQsImV4cCI6MjA3ODgwNDYyNH0.tBBTjltWuM3XQJbsB5IcCtDFNTLmaD8_ay4BVE5dw6E';

    function RecipeDatabase() {
      const [recipes, setRecipes] = useState([]);
      const [searchTerm, setSearchTerm] = useState('');
      const [categoryFilter, setCategoryFilter] = useState('all');
      const [tagFilter, setTagFilter] = useState('all');
      const [showAddForm, setShowAddForm] = useState(false);
      const [editingRecipe, setEditingRecipe] = useState(null);
      const [showShareInfo, setShowShareInfo] = useState(false);
      const [userName, setUserName] = useState('');
      const [showNamePrompt, setShowNamePrompt] = useState(false);
      const [commentText, setCommentText] = useState({});
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState('');
      const [newRecipe, setNewRecipe] = useState({
        name: '',
        ingredients: '',
        instructions: '',
        prepTime: '',
        servings: '',
        category: 'main',
        source: '',
        tags: ''
      });

      const categories = [
        { value: 'main', label: 'Main Dish' },
        { value: 'side', label: 'Side Dish' },
        { value: 'drink', label: 'Drink' },
        { value: 'dessert', label: 'Dessert' },
        { value: 'appetizer', label: 'Appetizer' }
      ];

      useEffect(() => {
        loadUserName();
        loadRecipes();
      }, []);

      useEffect(() => {
        lucide.createIcons();
      });

      const loadUserName = () => {
        const stored = localStorage.getItem('userName');
        if (stored) {
          setUserName(stored);
        } else {
          setShowNamePrompt(true);
        }
      };

      const saveUserName = (name) => {
        if (!name.trim()) {
          alert('Please enter a name');
          return;
        }
        localStorage.setItem('userName', name.trim());
        setUserName(name.trim());
        setShowNamePrompt(false);
      };

      const loadRecipes = async () => {
        setLoading(true);
        setError('');
        try {
          const response = await fetch(`${SUPABASE_URL}/rest/v1/recipes?select=*&order=date_added.desc`, {
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            }
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Failed to load recipes: ${response.status}`);
          }
          
          const data = await response.json();
          setRecipes(data);
        } catch (err) {
          console.error('Load error:', err);
          setError(`Failed to load recipes: ${err.message}`);
        } finally {
          setLoading(false);
        }
      };

      const getAllTags = () => {
        const tagSet = new Set();
        recipes.forEach(recipe => {
          if (recipe.tags) {
            recipe.tags.forEach(tag => tagSet.add(tag));
          }
        });
        return Array.from(tagSet).sort();
      };

      const startEdit = (recipe) => {
        setEditingRecipe(recipe);
        setNewRecipe({
          name: recipe.name,
          ingredients: recipe.ingredients.join(', '),
          instructions: recipe.instructions,
          prepTime: recipe.prep_time,
          servings: recipe.servings,
          category: recipe.category,
          source: recipe.source || '',
          tags: recipe.tags ? recipe.tags.join(', ') : ''
        });
        setShowAddForm(true);
      };

      const cancelEdit = () => {
        setEditingRecipe(null);
        setNewRecipe({
          name: '',
          ingredients: '',
          instructions: '',
          prepTime: '',
          servings: '',
          category: 'main',
          source: '',
          tags: ''
        });
        setShowAddForm(false);
      };

      const saveRecipe = async () => {
        if (!newRecipe.name || !newRecipe.ingredients) {
          alert('Please fill in at least the recipe name and ingredients');
          return;
        }

        if (!userName) {
          alert('Please set your name first');
          setShowNamePrompt(true);
          return;
        }

        const recipeData = {
          name: newRecipe.name,
          ingredients: newRecipe.ingredients.split(',').map(i => i.trim()).filter(i => i),
          instructions: newRecipe.instructions,
          prep_time: newRecipe.prepTime,
          servings: newRecipe.servings,
          category: newRecipe.category,
          source: newRecipe.source,
          tags: newRecipe.tags ? newRecipe.tags.split(',').map(t => t.trim()).filter(t => t) : [],
          comments: []
        };

        try {
          if (editingRecipe) {
            const updateData = {
              ...recipeData,
              last_edited_by: userName,
              date_modified: new Date().toISOString()
            };

            const response = await fetch(`${SUPABASE_URL}/rest/v1/recipes?id=eq.${editingRecipe.id}`, {
              method: 'PATCH',
              headers: {
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation'
              },
              body: JSON.stringify(updateData)
            });

            if (!response.ok) throw new Error('Failed to update recipe');
          } else {
            const insertData = {
              ...recipeData,
              added_by: userName,
              date_added: new Date().toISOString()
            };

            const response = await fetch(`${SUPABASE_URL}/rest/v1/recipes`, {
              method: 'POST',
              headers: {
                'apikey': SUPABASE_ANON_KEY,
                'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                'Content-Type': 'application/json',
                'Prefer': 'return=representation'
              },
              body: JSON.stringify(insertData)
            });

            if (!response.ok) throw new Error('Failed to add recipe');
          }

          await loadRecipes();
          cancelEdit();
        } catch (err) {
          console.error('Save error:', err);
          alert('Failed to save recipe. Please try again.');
        }
      };

      const deleteRecipe = async (id) => {
        if (!confirm('Are you sure you want to delete this recipe?')) return;
        
        try {
          const response = await fetch(`${SUPABASE_URL}/rest/v1/recipes?id=eq.${id}`, {
            method: 'DELETE',
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
            }
          });

          if (!response.ok) throw new Error('Failed to delete recipe');
          
          await loadRecipes();
        } catch (err) {
          console.error('Delete error:', err);
          alert('Failed to delete recipe. Please try again.');
        }
      };

      const addComment = async (recipeId) => {
        const comment = commentText[recipeId];
        if (!comment || !comment.trim()) {
          alert('Please enter a comment');
          return;
        }

        if (!userName) {
          alert('Please set your name first');
          setShowNamePrompt(true);
          return;
        }

        try {
          const recipe = recipes.find(r => r.id === recipeId);
          const newComment = {
            id: Date.now(),
            text: comment.trim(),
            author: userName,
            date: new Date().toISOString()
          };

          const updatedComments = [...(recipe.comments || []), newComment];

          const response = await fetch(`${SUPABASE_URL}/rest/v1/recipes?id=eq.${recipeId}`, {
            method: 'PATCH',
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
              'Content-Type': 'application/json',
              'Prefer': 'return=representation'
            },
            body: JSON.stringify({ comments: updatedComments })
          });

          if (!response.ok) throw new Error('Failed to add comment');

          await loadRecipes();
          setCommentText({ ...commentText, [recipeId]: '' });
        } catch (err) {
          console.error('Comment error:', err);
          alert('Failed to add comment. Please try again.');
        }
      };

      const deleteComment = async (recipeId, commentId) => {
        if (!confirm('Delete this comment?')) return;
        
        try {
          const recipe = recipes.find(r => r.id === recipeId);
          const updatedComments = recipe.comments.filter(c => c.id !== commentId);

          const response = await fetch(`${SUPABASE_URL}/rest/v1/recipes?id=eq.${recipeId}`, {
            method: 'PATCH',
            headers: {
              'apikey': SUPABASE_ANON_KEY,
              'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
              'Content-Type': 'application/json',
              'Prefer': 'return=representation'
            },
            body: JSON.stringify({ comments: updatedComments })
          });

          if (!response.ok) throw new Error('Failed to delete comment');

          await loadRecipes();
        } catch (err) {
          console.error('Delete comment error:', err);
          alert('Failed to delete comment. Please try again.');
        }
      };

      const formatDate = (dateString) => {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
          year: 'numeric', 
          month: 'short', 
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
      };

      const filteredRecipes = recipes.filter(recipe => {
        const categoryMatch = categoryFilter === 'all' || recipe.category === categoryFilter;
        const tagMatch = tagFilter === 'all' || (recipe.tags && recipe.tags.includes(tagFilter));
        
        if (!searchTerm) return categoryMatch && tagMatch;
        
        const searchLower = searchTerm.toLowerCase();
        const nameMatch = recipe.name.toLowerCase().includes(searchLower);
        const ingredientMatch = recipe.ingredients.some(ing => 
          ing.toLowerCase().includes(searchLower)
        );
        const sourceMatch = recipe.source?.toLowerCase().includes(searchLower);
        const tagSearchMatch = recipe.tags?.some(tag => 
          tag.toLowerCase().includes(searchLower)
        );
        
        return categoryMatch && tagMatch && (nameMatch || ingredientMatch || sourceMatch || tagSearchMatch);
      });

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-50 to-amber-50 p-4 md:p-8">
          {showNamePrompt && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-xl p-6 max-w-md w-full shadow-2xl">
                <h2 className="text-2xl font-bold text-gray-800 mb-4">Welcome! What's your name?</h2>
                <p className="text-gray-600 mb-4">
                  Your name will be shown when you add or edit recipes, and when you comment.
                </p>
                <input
                  id="nameInput"
                  type="text"
                  placeholder="Enter your name"
                  className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-orange-400 mb-4"
                  onKeyPress={(e) => {
                    if (e.key === 'Enter') {
                      saveUserName(e.target.value);
                    }
                  }}
                  autoFocus
                />
                <button
                  onClick={() => {
                    const input = document.getElementById('nameInput');
                    saveUserName(input.value);
                  }}
                  className="w-full bg-orange-600 hover:bg-orange-700 text-white py-2 rounded-lg font-semibold transition-colors"
                >
                  Save Name
                </button>
              </div>
            </div>
          )}

          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-8">
              <div className="flex items-center justify-center gap-2 mb-2">
                <i data-lucide="chef-hat" className="w-10 h-10 text-orange-600"></i>
                <h1 className="text-4xl font-bold text-gray-800">Recipe Database</h1>
              </div>
              <p className="text-gray-600">Shared recipe collection powered by Supabase</p>
              
              <button
                onClick={() => setShowShareInfo(!showShareInfo)}
                className="mt-2 text-orange-600 hover:text-orange-700 flex items-center gap-1 mx-auto"
              >
                <i data-lucide="share-2" className="w-4 h-4"></i>
                <span className="ml-1">Install as iPhone App</span>
              </button>
              
              {showShareInfo && (
                <div className="mt-3 p-4 bg-blue-50 border-2 border-blue-200 rounded-lg text-left max-w-2xl mx-auto">
                  <h3 className="font-bold text-blue-900 mb-2">ðŸ“± Install as iPhone App (PWA):</h3>
                  <ol className="text-sm text-blue-800 space-y-1 list-decimal list-inside">
                    <li>Open this page in Safari on iPhone</li>
                    <li>Tap the Share button (square with arrow)</li>
                    <li>Scroll down and tap "Add to Home Screen"</li>
                    <li>Tap "Add" - it now works like a native app!</li>
                  </ol>
                  
                  {userName && (
                    <p className="text-sm text-blue-800 mt-3">
                      <strong>Signed in as:</strong> {userName} 
                      <button 
                        onClick={() => setShowNamePrompt(true)}
                        className="ml-2 text-blue-600 underline hover:text-blue-800"
                      >
                        (change)
                      </button>
                    </p>
                  )}
                </div>
              )}
            </div>

            {error && (
              <div className="mb-6 p-4 bg-red-50 border-2 border-red-200 rounded-lg text-red-800">
                {error}
              </div>
            )}

            {loading ? (
              <div className="text-center py-12">
                <i data-lucide="loader" className="w-12 h-12 text-orange-600 animate-spin mx-auto mb-4"></i>
                <p className="text-gray-600">Loading recipes...</p>
              </div>
            ) : (
              <>
                <div className="mb-6 space-y-4">
                  <div className="relative">
                    <i data-lucide="search" className="absolute left-4 top-3.5 text-gray-400 w-5 h-5"></i>
                    <input
                      type="text"
                      placeholder="Search by ingredient, recipe name, source, or tag..."
                      value={searchTerm}
                      onChange={(e) => setSearchTerm(e.target.value)}
                      className="w-full pl-12 pr-4 py-3 border-2 border-orange-200 rounded-lg focus:outline-none focus:border-orange-400 text-lg"
                    />
                  </div>

                  <div>
                    <div className="text-sm font-semibold text-gray-700 mb-2">Category:</div>
                    <div className="flex gap-2 flex-wrap">
                      <button
                        onClick={() => setCategoryFilter('all')}
                        className={`px-4 py-2 rounded-lg font-semibold transition-colors ${
                          categoryFilter === 'all' ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-100'
                        }`}
                      >
                        All
                      </button>
                      {categories.map(cat => (
                        <button
                          key={cat.value}
                          onClick={() => setCategoryFilter(cat.value)}
                          className={`px-4 py-2 rounded-lg font-semibold transition-colors ${
                            categoryFilter === cat.value ? 'bg-orange-600 text-white' : 'bg-white text-gray-700 hover:bg-orange-100'
                          }`}
                        >
                          {cat.label}
                        </button>
                      ))}
                    </div>
                  </div>

                  {getAllTags().length > 0 && (
                    <div>
                      <div className="text-sm font-semibold text-gray-700 mb-2 flex items-center gap-1">
                        <i data-lucide="tag" className="w-4 h-4"></i>
                        <span className="ml-1">Tags:</span>
                      </div>
                      <div className="flex gap-2 flex-wrap">
                        <button
                          onClick={() => setTagFilter('all')}
                          className={`px-3 py-1 rounded-full text-sm font-semibold transition-colors ${
                            tagFilter === 'all' ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-purple-100'
                          }`}
                        >
                          All
                        </button>
                        {getAllTags().map(tag => (
                          <button
                            key={tag}
                            onClick={() => setTagFilter(tag)}
                            className={`px-3 py-1 rounded-full text-sm font-semibold transition-colors ${
                              tagFilter === tag ? 'bg-purple-600 text-white' : 'bg-white text-gray-700 hover:bg-purple-100'
                            }`}
                          >
                            {tag}
                          </button>
                        ))}
                      </div>
                    </div>
                  )}
                </div>

                <div className="mb-6 flex justify-center">
                  <button
                    onClick={() => showAddForm ? cancelEdit() : setShowAddForm(true)}
                    className="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 font-semibold transition-colors"
                  >
                    {showAddForm ? <i data-lucide="x" className="w-5 h-5"></i> : <i data-lucide="plus" className="w-5 h-5"></i>}
                    <span className="ml-1">{showAddForm ? 'Cancel' : 'Add New Recipe'}</span>
                  </button>
                </div>

                {showAddForm && (
                  <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 className="text-2xl font-bold text-gray-800 mb-4">
                      {editingRecipe ? 'Edit Recipe' : 'Add New Recipe'}
                    </h2>

                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">Recipe Name *</label>
                        <input
                          type="text"
                          value={newRecipe.name}
                          onChange={(e) => setNewRecipe({...newRecipe, name: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                          placeholder="e.g., Spaghetti Carbonara"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-1">Category *</label>
                          <select
                            value={newRecipe.category}
                            onChange={(e) => setNewRecipe({...newRecipe, category: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                          >
                            {categories.map(cat => (
                              <option key={cat.value} value={cat.value}>{cat.label}</option>
                            ))}
                          </select>
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-1">Source</label>
                          <input
                            type="text"
                            value={newRecipe.source}
                            onChange={(e) => setNewRecipe({...newRecipe, source: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                            placeholder="e.g., Grandma, NYT Cooking"
                          />
                        </div>
                      </div>
                      
                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1 flex items-center gap-1">
                          <i data-lucide="tag" className="w-4 h-4"></i>
                          <span className="ml-1">Tags (comma-separated)</span>
                        </label>
                        <input
                          type="text"
                          value={newRecipe.tags}
                          onChange={(e) => setNewRecipe({...newRecipe, tags: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                          placeholder="e.g., quick, vegetarian, comfort food"
                        />
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">Ingredients * (comma-separated)</label>
                        <textarea
                          value={newRecipe.ingredients}
                          onChange={(e) => setNewRecipe({...newRecipe, ingredients: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                          rows="3"
                          placeholder="e.g., pasta, eggs, bacon, parmesan cheese, black pepper"
                        />
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-1">Prep Time</label>
                          <input
                            type="text"
                            value={newRecipe.prepTime}
                            onChange={(e) => setNewRecipe({...newRecipe, prepTime: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                            placeholder="e.g., 30 minutes"
                          />
                        </div>
                        <div>
                          <label className="block text-sm font-semibold text-gray-700 mb-1">Servings</label>
                          <input
                            type="text"
                            value={newRecipe.servings}
                            onChange={(e) => setNewRecipe({...newRecipe, servings: e.target.value})}
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                            placeholder="e.g., 4"
                          />
                        </div>
                      </div>

                      <div>
                        <label className="block text-sm font-semibold text-gray-700 mb-1">Instructions</label>
                        <textarea
                          value={newRecipe.instructions}
                          onChange={(e) => setNewRecipe({...newRecipe, instructions: e.target.value})}
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400"
                          rows="5"
                          placeholder="Step-by-step cooking instructions..."
                        />
                      </div>

                      <button
                        onClick={saveRecipe}
                        className="w-full bg-orange-600 hover:bg-orange-700 text-white py-3 rounded-lg font-semibold transition-colors"
                      >
                        {editingRecipe ? 'Update Recipe' : 'Save Recipe'}
                      </button>
                    </div>
                  </div>
                )}
                <div className="space-y-4">
                  {filteredRecipes.length === 0 ? (
                    <div className="text-center py-12 bg-white rounded-xl shadow">
                      <i data-lucide="chef-hat" className="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                      <p className="text-gray-500 text-lg">
                        {recipes.length === 0 
                          ? 'No recipes yet. Add your first recipe to get started!' 
                          : 'No recipes found matching your filters.'}
                      </p>
                    </div>
                  ) : (
                    filteredRecipes.map(recipe => (
                      <div key={recipe.id} className="bg-white rounded-xl shadow-lg p-6 hover:shadow-xl transition-shadow">
                        <div className="flex justify-between items-start mb-4">
                          <div className="flex-1">
                            <h3 className="text-2xl font-bold text-gray-800">{recipe.name}</h3>
                            <div className="flex flex-wrap gap-2 mt-2">
                              <span className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold">
                                {categories.find(c => c.value === recipe.category)?.label}
                              </span>
                              {recipe.source && (
                                <span className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">
                                  ðŸ“– {recipe.source}
                                </span>
                              )}
                              {recipe.tags && recipe.tags.map(tag => (
                                <span key={tag} className="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                                  #{tag}
                                </span>
                              ))}
                            </div>
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => startEdit(recipe)}
                              className="text-blue-500 hover:text-blue-700 transition-colors"
                              title="Edit recipe"
                            >
                              <i data-lucide="edit-2" className="w-5 h-5"></i>
                            </button>
                            <button
                              onClick={() => deleteRecipe(recipe.id)}
                              className="text-red-500 hover:text-red-700 transition-colors"
                              title="Delete recipe"
                            >
                              <i data-lucide="x" className="w-5 h-5"></i>
                            </button>
                          </div>
                        </div>

                        <div className="flex gap-4 mb-4 text-sm text-gray-600">
                          {recipe.prep_time && (
                            <div className="flex items-center gap-1">
                              <i data-lucide="clock" className="w-4 h-4"></i>
                              {recipe.prep_time}
                            </div>
                          )}
                          {recipe.servings && (
                            <div className="flex items-center gap-1">
                              <i data-lucide="users" className="w-4 h-4"></i>
                              {recipe.servings} servings
                            </div>
                          )}
                        </div>

                        <div className="mb-4 pb-4 border-b border-gray-200 text-xs text-gray-500">
                          {recipe.added_by && (
                            <div>Added by <span className="font-semibold">{recipe.added_by}</span> on {formatDate(recipe.date_added)}</div>
                          )}
                          {recipe.last_edited_by && (
                            <div className="mt-1">Last edited by <span className="font-semibold">{recipe.last_edited_by}</span> on {formatDate(recipe.date_modified)}</div>
                          )}
                        </div>

                        <div className="mb-4">
                          <h4 className="font-semibold text-gray-700 mb-2">Ingredients:</h4>
                          <div className="flex flex-wrap gap-2">
                            {recipe.ingredients.map((ing, idx) => (
                              <span 
                                key={idx}
                                className="bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm"
                              >
                                {ing}
                              </span>
                            ))}
                          </div>
                        </div>

                        {recipe.instructions && (
                          <div className="mb-4">
                            <h4 className="font-semibold text-gray-700 mb-2">Instructions:</h4>
                            <p className="text-gray-600 whitespace-pre-line">{recipe.instructions}</p>
                          </div>
                        )}

                        <div className="mt-6 pt-6 border-t border-gray-200">
                          <h4 className="font-semibold text-gray-700 mb-3 flex items-center gap-2">
                            ðŸ’¬ Comments ({recipe.comments?.length || 0})
                          </h4>
                          
                          <div className="mb-4 flex gap-2">
                            <input
                              type="text"
                              placeholder="Add a comment..."
                              value={commentText[recipe.id] || ''}
                              onChange={(e) => setCommentText({ ...commentText, [recipe.id]: e.target.value })}
                              onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                  addComment(recipe.id);
                                }
                              }}
                              className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-orange-400 text-sm"
                            />
                            <button
                              onClick={() => addComment(recipe.id)}
                              className="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors text-sm"
                            >
                              Post
                            </button>
                          </div>

                          {recipe.comments && recipe.comments.length > 0 ? (
                            <div className="space-y-3">
                              {recipe.comments.map(comment => (
                                <div key={comment.id} className="bg-gray-50 rounded-lg p-3">
                                  <div className="flex justify-between items-start mb-1">
                                    <span className="font-semibold text-gray-800 text-sm">{comment.author}</span>
                                    <div className="flex items-center gap-2">
                                      <span className="text-xs text-gray-500">{formatDate(comment.date)}</span>
                                      {comment.author === userName && (
                                        <button
                                          onClick={() => deleteComment(recipe.id, comment.id)}
                                          className="text-red-500 hover:text-red-700"
                                        >
                                          <i data-lucide="x" className="w-3 h-3"></i>
                                        </button>
                                      )}
                                    </div>
                                  </div>
                                  <p className="text-gray-700 text-sm">{comment.text}</p>
                                </div>
                              ))}
                            </div>
                          ) : (
                            <p className="text-gray-400 text-sm italic">No comments yet. Be the first to comment!</p>
                          )}
                        </div>
                      </div>
                    ))
                  )}
                </div>
              </>
            )}
          </div>
        </div>
      );
    }

    ReactDOM.render(<RecipeDatabase />, document.getElementById('root'));
  </script>
</body>
</html>